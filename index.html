
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>WebRTC SDP Exchange & Chat</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			background: #f7f7f7;
		}
		.container {
			max-width: 600px;
			margin: 0 auto;
			padding: 20px;
		}
		h1 {
			font-size: 1.7em;
			margin-bottom: 20px;
			text-align: center;
		}
		h2 {
			margin-top: 30px;
			font-size: 1.1em;
		}
		textarea {
			width: 100%;
			min-height: 80px;
			max-height: 200px;
			margin-bottom: 10px;
			font-size: 1em;
			padding: 8px;
			box-sizing: border-box;
			border-radius: 6px;
			border: 1px solid #ccc;
			resize: vertical;
		}
		button {
			margin: 5px 0;
			padding: 8px 16px;
			font-size: 1em;
			border-radius: 6px;
			border: none;
			background: #1976d2;
			color: #fff;
			cursor: pointer;
			transition: background 0.2s;
		}
		button:disabled {
			background: #aaa;
			cursor: not-allowed;
		}
		button:hover:not(:disabled) {
			background: #1565c0;
		}
		#chat {
			border: 1px solid #ccc;
			background: #fff;
			padding: 10px;
			height: 160px;
			overflow-y: auto;
			margin-bottom: 10px;
			border-radius: 6px;
			font-size: 1em;
		}
		#chat div {
			margin-bottom: 4px;
		}
		.chat-input-row {
			display: flex;
			gap: 8px;
		}
		#message {
			flex: 1;
			font-size: 1em;
			padding: 8px;
			border-radius: 6px;
			border: 1px solid #ccc;
			box-sizing: border-box;
		}
		@media (max-width: 700px) {
			.container {
				max-width: 100%;
				padding: 10px;
			}
			h1 {
				font-size: 1.2em;
			}
			h2 {
				font-size: 1em;
			}
			#chat {
				height: 120px;
			}
			button, #message, textarea {
				font-size: 0.95em;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>WebRTC SDP Exchange & Chat</h1>
		<div>
			<h2>Step 1: (Local) Create Offer</h2>
			<button id="createOffer">Create Offer</button>
			<textarea id="localOffer" readonly placeholder="Local SDP Offer"></textarea>
			<div style="display: flex; gap: 8px; flex-wrap: wrap;">
				<button id="copyOffer">Copy Offer</button>
				<button id="shareOffer">Share</button>
			</div>
		</div>
		<div>
			<h2>Step 2: (Remote) Paste Remote Offer</h2>
			<textarea id="remoteOffer" placeholder="Paste remote SDP offer here"></textarea>
			<button id="setRemoteOffer">Set Remote Offer</button>
		</div>
		<div>
			<h2>Step 3: (Remote) Create Answer</h2>
			<button id="createAnswer">Create Answer</button>
			<textarea id="localAnswer" readonly placeholder="Local SDP Answer"></textarea>
			<div style="display: flex; gap: 8px; flex-wrap: wrap;">
				<button id="copyAnswer">Copy Answer</button>
				<button id="shareAnswer">Share</button>
			</div>
		</div>
		<div>
			<h2>Step 4: (Local) Paste Remote Answer</h2>
			<textarea id="remoteAnswer" placeholder="Paste remote SDP answer here"></textarea>
			<button id="setRemoteAnswer">Set Remote Answer</button>
		</div>
		<div>
			<h2>Chat</h2>
			<div id="chat"></div>
			<div class="chat-input-row">
				<input type="text" id="message" placeholder="Type a message..." />
				<button id="send">Send</button>
			</div>
		</div>
	</div>

	<script>
	// Google's public STUN server
	const rtcConfig = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
	let pc = null;
	let dataChannel = null;
	let isOfferer = false;

	function logChat(msg, isLocal) {
		const chat = document.getElementById('chat');
		const div = document.createElement('div');
		div.textContent = (isLocal ? 'Me: ' : 'Peer: ') + msg;
		div.style.textAlign = isLocal ? 'right' : 'left';
		chat.appendChild(div);
		chat.scrollTop = chat.scrollHeight;
	}

	function setupPeerConnection() {
		pc = new RTCPeerConnection(rtcConfig);
		pc.onicecandidate = e => {
			if (e.candidate) return;
			// ICE gathering complete, update SDP
			if (isOfferer) {
				document.getElementById('localOffer').value = pc.localDescription.sdp;
			} else {
				document.getElementById('localAnswer').value = pc.localDescription.sdp;
			}
		};
		pc.ondatachannel = e => {
			dataChannel = e.channel;
			setupDataChannel();
		};
	}

	function setupDataChannel() {
		dataChannel.onopen = () => {
			document.getElementById('send').disabled = false;
		};
		dataChannel.onmessage = e => {
			logChat(e.data, false);
		};
	}

	document.getElementById('createOffer').onclick = async () => {
		isOfferer = true;
		setupPeerConnection();
		dataChannel = pc.createDataChannel('chat');
		setupDataChannel();
		const offer = await pc.createOffer();
		await pc.setLocalDescription(offer);
		// SDP will be set after ICE gathering
	};

	document.getElementById('copyOffer').onclick = () => {
		navigator.clipboard.writeText(document.getElementById('localOffer').value);
	};
	document.getElementById('shareOffer').onclick = () => {
		const sdp = document.getElementById('localOffer').value;
		shareSDP(sdp, 'SDP Offer');
	};

	document.getElementById('setRemoteAnswer').onclick = async () => {
		const sdp = document.getElementById('remoteAnswer').value;
		if (!pc) return alert('Create offer first!');
		await pc.setRemoteDescription(new RTCSessionDescription({ type: 'answer', sdp }));
	};

	document.getElementById('setRemoteOffer').onclick = async () => {
		isOfferer = false;
		setupPeerConnection();
		const sdp = document.getElementById('remoteOffer').value;
		await pc.setRemoteDescription(new RTCSessionDescription({ type: 'offer', sdp }));
	};

	document.getElementById('createAnswer').onclick = async () => {
		if (!pc) return alert('Paste remote offer first!');
		const answer = await pc.createAnswer();
		await pc.setLocalDescription(answer);
		// SDP will be set after ICE gathering
	};

	document.getElementById('copyAnswer').onclick = () => {
		navigator.clipboard.writeText(document.getElementById('localAnswer').value);
	};
	document.getElementById('shareAnswer').onclick = () => {
		const sdp = document.getElementById('localAnswer').value;
		shareSDP(sdp, 'SDP Answer');
	};

	function sendMessage() {
		const msg = document.getElementById('message').value;
		if (dataChannel && dataChannel.readyState === 'open' && msg.trim() !== '') {
			dataChannel.send(msg);
			logChat(msg, true);
			document.getElementById('message').value = '';
		}
	}
	document.getElementById('send').onclick = sendMessage;
	document.getElementById('message').addEventListener('keydown', function(e) {
		if (e.key === 'Enter') {
			e.preventDefault();
			sendMessage();
		}
	});
	document.getElementById('send').disabled = true;

	function shareSDP(text, label) {
		const shareData = {
			text: text
		};
		// Check for Web Share API support
		if (typeof navigator.share === 'function') {
			navigator.share(shareData)
				.catch((err) => {
					// User cancelled or error
				});
		} else {
			alert('Sharing is only supported on mobile browsers. Please copy and paste manually.');
		}
	}
	</script>
</body>
</html>
